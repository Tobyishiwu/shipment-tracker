<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GID Logistics | Smart Tracking</title>

  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root {
      --gid-red:#e31e24;
      --gid-black:#0f172a;
      --bg:#f8fafc;
    }
    *{box-sizing:border-box;font-family:'Plus Jakarta Sans',sans-serif}
    body{margin:0;background:var(--bg);color:#1e293b}
    header{background:#fff;padding:1rem;text-align:center;border-bottom:4px solid var(--gid-red)}
    .logo{font-weight:800;font-size:1.4rem}
    .logo span{color:var(--gid-red)}
    .hero{text-align:center;padding:40px 20px}
    .card{background:#fff;max-width:620px;margin:auto;padding:30px;border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,.08)}
    .input-box{display:flex;background:#f1f5f9;border-radius:12px;padding:6px}
    input{flex:1;border:none;background:transparent;padding:14px;font-size:1rem;font-weight:700;text-transform:uppercase;outline:none}
    button{border:none;border-radius:10px;padding:0 24px;font-weight:800;cursor:pointer}
    .track-btn{background:var(--gid-black);color:#fff}
    #results{display:none;margin-top:30px;animation:fadeUp .5s ease}
    .status-box{background:var(--gid-black);color:#fff;padding:22px;border-radius:14px}
    .status-box small{opacity:.7;font-weight:700;letter-spacing:1px}
    .status-box h2{margin:6px 0 0;font-size:1.8rem}
    .milestones{position:relative;margin:40px 0}
    .line{position:absolute;top:12px;left:0;right:0;height:4px;background:#e5e7eb}
    #bar{position:absolute;top:12px;left:0;height:4px;background:var(--gid-red);transition:1.2s}
    .nodes{display:flex;justify-content:space-between;position:relative}
    .node{text-align:center;width:20%}
    .dot{width:22px;height:22px;border-radius:50%;border:4px solid #e5e7eb;background:#fff;margin:auto}
    .node.active .dot{background:var(--gid-red);border-color:var(--gid-red)}
    .node label{display:block;margin-top:8px;font-size:.6rem;font-weight:800;color:#94a3b8}
    .node.active label{color:#0f172a}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .item{background:#f8fafc;padding:14px;border-radius:10px;border:1px solid #eee}
    .item label{font-size:.6rem;font-weight:800;color:#94a3b8}
    #receipt{display:none;margin-top:15px;background:var(--gid-red);color:#fff;width:100%;padding:16px}
    #reset{background:none;color:var(--gid-red);margin-top:15px}
    @keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1}}
    #wa{position:fixed;bottom:25px;right:25px}
    #wa a{width:60px;height:60px;border-radius:50%;background:#25d366;color:#fff;display:flex;align-items:center;justify-content:center}
  </style>
</head>

<body>

<header>
  <div class="logo">GID <span>LOGISTICS</span></div>
</header>

<section class="hero">
  <h1>Smart Shipment Tracking</h1>
  <p>Real-time visibility for your deliveries.</p>
</section>

<div class="card">
  <div class="input-box">
    <input id="trackInput" placeholder="Enter Waybill No">
    <button class="track-btn" id="trackBtn">TRACK</button>
  </div>

  <div id="results">
    <div class="status-box">
      <small>CURRENT STATUS</small>
      <h2 id="statusText">â€”</h2>
    </div>

    <div class="milestones">
      <div class="line"></div>
      <div id="bar"></div>
      <div class="nodes">
        <div class="node" id="n1"><div class="dot"></div><label>Created</label></div>
        <div class="node" id="n2"><div class="dot"></div><label>Picked Up</label></div>
        <div class="node" id="n3"><div class="dot"></div><label>In Transit</label></div>
        <div class="node" id="n4"><div class="dot"></div><label>Out</label></div>
        <div class="node" id="n5"><div class="dot"></div><label>Delivered</label></div>
      </div>
    </div>

    <div class="grid">
      <div class="item"><label>LOCATION</label><div id="locText"></div></div>
      <div class="item"><label>LAST UPDATE</label><div id="timeText"></div></div>
    </div>

    <button id="receipt">DOWNLOAD RECEIPT</button>
    <button id="reset" onclick="location.reload()">START NEW SEARCH</button>
  </div>
</div>

<div id="wa">
  <a id="waLink" target="_blank">ðŸ’¬</a>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbz2076OPCNES9Gf0S1r_zYw1nEWs5JGsjTAdKP-jlQSujZijJrTIMDpzHE-ljoSkOTV/exec";
const btn = document.getElementById('trackBtn');
let fetching = false;

btn.onclick = fetchShipment;

function fetchShipment(){
  if(fetching) return;
  const id = trackInput.value.trim().toUpperCase();
  if(!id) return alert("Enter tracking number");

  fetching = true;
  btn.innerText = "WAIT...";
  btn.disabled = true;

  const old = document.getElementById("jsonp");
  if(old) old.remove();

  const s = document.createElement("script");
  s.id = "jsonp";
  s.src = `${SCRIPT_URL}?tracking=${encodeURIComponent(id)}&callback=handleResponse`;
  s.onerror = fail;
  document.body.appendChild(s);

  waLink.href = `https://wa.me/2347066958826?text=Hello GID Support, tracking ${id}`;
}

function handleResponse(data){
  cleanup();

  if(data.error){
    alert(data.error);
    return;
  }

  results.style.display = "block";
  statusText.innerText = data.status;
  locText.innerText = data.currentLocation || "â€”";
  timeText.innerText = data.lastUpdated || "Just now";

  const s = data.status.toLowerCase();
  let p=0,n=0;

  if(s.includes("delivered")){p=100;n=5}
  else if(s.includes("delivery")){p=75;n=4}
  else if(s.includes("transit")){p=50;n=3}
  else if(s.includes("picked")){p=25;n=2}
  else{p=5;n=1}

  bar.style.width = p+"%";
  for(let i=1;i<=5;i++){
    document.getElementById("n"+i).classList.toggle("active",i<=n);
  }

  if(n===5){
    receipt.style.display="block";
    receipt.onclick=()=>window.open(`${SCRIPT_URL}?tracking=${encodeURIComponent(trackInput.value)}&mode=receipt`,"_blank");
  }

  results.scrollIntoView({behavior:"smooth"});
}

function cleanup(){
  fetching=false;
  btn.innerText="TRACK";
  btn.disabled=false;
  const s=document.getElementById("jsonp");
  if(s) s.remove();
}

function fail(){
  cleanup();
  alert("Unable to connect to tracking server.");
}

window.onload=()=>{
  const id=new URLSearchParams(location.search).get("id");
  if(id){trackInput.value=id;fetchShipment();}
}
</script>

</body>
</html>
