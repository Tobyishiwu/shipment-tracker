<!DOCTYPE html>
<html>
<head>
    <title>GID Admin | v14.0</title>
    <style>
        body{font-family:sans-serif; background:#f0f2f5; padding:20px}
        .card{background:#fff; padding:30px; border-radius:15px; max-width:500px; margin:auto; box-shadow:0 4px 10px rgba(0,0,0,0.1)}
        input, select, button{width:100%; padding:12px; margin:8px 0; border-radius:8px; border:1px solid #ddd}
        button{background:#0f172a; color:#fff; font-weight:bold; cursor:pointer}
        .hidden{display:none}
        .item{padding:10px; border-bottom:1px solid #eee; font-size:12px}
    </style>
</head>
<body>

<div id="login" class="card">
    <h2>Admin Login</h2>
    <input type="password" id="pin" placeholder="Enter PIN">
    <button onclick="login()">Enter Dashboard</button>
</div>

<div id="admin" class="card hidden">
    <h2 style="color:#e31e24">Update Shipment</h2>
    <input id="uid" placeholder="GID ID (e.g. GID-101)">
    <input id="uloc" placeholder="Current Location">
    <select id="ustat">
        <option value="Processing">Processing</option>
        <option value="In Transit">In Transit</option>
        <option value="Arrived at Hub">Arrived at Hub</option>
        <option value="Delivered">Delivered</option>
    </select>
    <button onclick="update()">Update Sheet</button>
    <hr>
    <h3>Latest Quotes</h3>
    <div id="list">Loading...</div>
</div>

<script>
const URL = "https://script.google.com/macros/s/AKfycbzWO6fvhJ7mmrOsXc3MWRY040RJM4IxbVXH9d_y7dTI0HyxT-FlCmxHhX2n1lx3prbO/exec";

function login(){
    if(document.getElementById('pin').value === "1234"){
        document.getElementById('login').classList.add('hidden');
        document.getElementById('admin').classList.remove('hidden');
        load();
    }
}

function load(){
    callApi("action=fetchAll", (d) => {
        document.getElementById('list').innerHTML = d.quotes.reverse().map(q => `<div class="item">${q[1]} - ${q[5]} to ${q[4]} (${q[7]})</div>`).join('');
    });
}

function update(){
    const id = document.getElementById('uid').value;
    const loc = document.getElementById('uloc').value;
    const stat = document.getElementById('ustat').value;
    callApi(`action=updateStatus&id=${id}&location=${loc}&status=${stat}`, (r) => {
        alert("Success!");
        load();
    });
}

function callApi(p, cbName){
    const id = 'cb_'+Math.floor(Math.random()*10e6);
    window[id] = (d) => { delete window[id]; cbName(d); };
    const s = document.createElement('script');
    s.src = `${URL}?${p}&callback=${id}`;
    document.body.appendChild(s);
}
</script>
</body>
</html>
